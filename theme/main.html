<!doctype html>
<html lang="en" class="">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if page.title %}{{ page.title }} - {% endif %}{{ config.site_name }}</title>
  <meta name="description" content="{% if page.meta.description %}{{ page.meta.description }}{% else %}{{ config.site_description }}{% endif %}">
  <meta name="author" content="{{ config.site_name }}">
  <link rel="canonical" href="{{ config.site_url }}{{ page.url }}">

  <!-- Open Graph -->
  <meta property="og:type" content="{% if page.meta.date %}article{% else %}website{% endif %}">
  <meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ config.site_name }}{% endif %}">
  <meta property="og:description" content="{% if page.meta.description %}{{ page.meta.description }}{% else %}{{ config.site_description }}{% endif %}">
  <meta property="og:url" content="{{ config.site_url }}{{ page.url }}">
  <meta property="og:site_name" content="{{ config.site_name }}">
  <meta property="og:locale" content="en_AU">
  {% if page.meta.date %}
  <meta property="article:published_time" content="{{ page.meta.date }}">
  <meta property="article:author" content="{{ config.site_name }}">
  {% if page.meta.tags %}{% for tag in page.meta.tags %}
  <meta property="article:tag" content="{{ tag }}">
  {% endfor %}{% endif %}
  {% endif %}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ config.site_name }}{% endif %}">
  <meta name="twitter:description" content="{% if page.meta.description %}{{ page.meta.description }}{% else %}{{ config.site_description }}{% endif %}">

  <link rel="icon" type="image/svg+xml" href="{{ 'favicon.svg' | url }}">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- CSS -->
  {% for css_file in config.extra_css %}
  <link rel="stylesheet" href="{{ css_file | url }}">
  {% endfor %}

  <!-- Dark mode: prevent flash -->
  <script>
    (function() {
      var theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <!-- Structured Data -->
  {% if page.meta.date %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "{{ page.title }}",
    "description": "{{ page.meta.description | default(config.site_description) }}",
    "datePublished": "{{ page.meta.date }}",
    "author": {
      "@type": "Person",
      "name": "{{ config.site_name }}",
      "url": "{{ config.site_url }}"
    },
    "publisher": {
      "@type": "Person",
      "name": "{{ config.site_name }}"
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ config.site_url }}{{ page.url }}"
    }
    {% if page.meta.tags %},"keywords": "{{ page.meta.tags | join(', ') }}"{% endif %}
  }
  </script>
  {% else %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{{ config.site_name }}",
    "url": "{{ config.site_url }}",
    "description": "{{ config.site_description }}"
  }
  </script>
  {% endif %}
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-950/80 backdrop-blur-md sticky top-0 z-40">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
      <a href="{{ config.site_url or '/' }}" class="text-xl font-bold text-gray-900 dark:text-gray-100 hover:text-gray-600 dark:hover:text-gray-400 transition-colors">
        {{ config.site_name }}
      </a>

      <!-- Desktop nav -->
      <nav class="hidden sm:flex items-center gap-1">
        {% for nav_item in nav %}
          {% if nav_item.children %}
            <a href="{{ nav_item.children[0].url | url }}" class="px-3 py-1.5 rounded-full text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors {% if nav_item.active %}text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-800{% endif %}">
              {{ nav_item.title }}
            </a>
          {% else %}
            <a href="{{ nav_item.url | url }}" class="px-3 py-1.5 rounded-full text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors {% if nav_item.active %}text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-800{% endif %}">
              {{ nav_item.title }}
            </a>
          {% endif %}
        {% endfor %}
        <!-- Divider -->
        <div class="w-px h-5 bg-gray-200 dark:bg-gray-700 mx-1"></div>
        <button id="theme-toggle" type="button" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-label="Toggle dark mode">
          <!-- Sun icon (shown in dark mode) -->
          <svg class="hidden dark:block w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg class="block dark:hidden w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
          </svg>
        </button>
      </nav>

      <!-- Mobile menu button -->
      <div class="flex items-center gap-2 sm:hidden">
        <button id="theme-toggle-mobile" type="button" class="p-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-label="Toggle dark mode">
          <svg class="hidden dark:block w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
          <svg class="block dark:hidden w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
          </svg>
        </button>
        <button id="menu-toggle" type="button" class="p-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-label="Open menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile drawer overlay -->
  <div id="drawer-overlay" class="fixed inset-0 bg-black/50 z-40 hidden sm:hidden" aria-hidden="true"></div>

  <!-- Mobile drawer -->
  <aside id="drawer" class="fixed top-0 right-0 h-full w-64 bg-white dark:bg-gray-900 shadow-xl z-50 translate-x-full transition-transform duration-200 ease-in-out sm:hidden">
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800">
      <span class="font-semibold text-gray-900 dark:text-gray-100">Menu</span>
      <button id="drawer-close" type="button" class="p-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-label="Close menu">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <nav class="p-4 flex flex-col gap-2">
      {% for nav_item in nav %}
        {% if nav_item.children %}
          <a href="{{ nav_item.children[0].url | url }}" class="block px-3 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-gray-100 transition-colors {% if nav_item.active %}bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100{% endif %}">
            {{ nav_item.title }}
          </a>
        {% else %}
          <a href="{{ nav_item.url | url }}" class="block px-3 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-gray-100 transition-colors {% if nav_item.active %}bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100{% endif %}">
            {{ nav_item.title }}
          </a>
        {% endif %}
      {% endfor %}
    </nav>
  </aside>

  <!-- Main content -->
  <main class="flex-1">

    {% if page.meta.is_homepage %}
    <!-- ==================== HOMEPAGE ==================== -->

    <!-- Hero section -->
    <section class="border-b border-gray-200 dark:border-gray-800">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 py-16 sm:py-24">
        <div class="max-w-2xl">
          <h1 class="text-4xl sm:text-5xl font-bold tracking-tight text-gray-900 dark:text-gray-100 mb-4">
            Hi, I'm Nile
          </h1>
          <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-400 mb-8">
            Software engineer writing about technology, tools, and things I find interesting.
          </p>
          <div class="flex flex-wrap gap-3">
            <a href="{{ 'blog/posts/squishy-humans-need-not-apply/' | url }}" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-full bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 font-medium text-sm hover:bg-gray-700 dark:hover:bg-gray-300 transition-colors">
              Read the blog
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Blog post cards -->
    <section class="max-w-4xl mx-auto px-4 sm:px-6 py-12">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6">Latest Posts</h2>
      <div class="space-y-4">
        {% for nav_item in nav %}
          {% if nav_item.children %}
            {% for post in nav_item.children %}
              {% if post.meta and post.meta.date %}
              <a href="{{ post.url | url }}" class="group block rounded-xl border border-gray-200 dark:border-gray-800 p-5 sm:p-6 hover:border-gray-900 dark:hover:border-gray-100 hover:shadow-lg transition-all duration-200">
                <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-gray-500 dark:text-gray-400 mb-2">
                  <time datetime="{{ post.meta.date }}">
                    <span class="inline-flex items-center gap-1">
                      <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                      {{ post.meta.date }}
                    </span>
                  </time>
                  {% if post.meta.tags %}
                  <span class="text-gray-300 dark:text-gray-600">|</span>
                  {% for tag in post.meta.tags %}
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ring-1 ring-gray-300 dark:ring-gray-700 text-gray-600 dark:text-gray-400">{{ tag }}</span>
                  {% endfor %}
                  {% endif %}
                </div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors mb-1">{{ post.title }}</h3>
                {% if post.meta.description %}
                <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">{{ post.meta.description }}</p>
                {% endif %}
              </a>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </div>
    </section>

    {% else %}
    <!-- ==================== REGULAR PAGE ==================== -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-8 sm:py-12">

      {% if page.meta.date %}
      <!-- Blog post header -->
      <div class="mb-8">
        <!-- Back link -->
        <a href="{{ '/' | url }}" class="inline-flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors mb-6">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          Back to all posts
        </a>
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-3">{{ page.title }}</h1>
        <div class="flex flex-wrap items-center gap-x-3 gap-y-2 text-sm text-gray-500 dark:text-gray-400">
          <time datetime="{{ page.meta.date }}" class="inline-flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            {{ page.meta.date }}
          </time>
          {% if page.meta.tags %}
          <span class="text-gray-300 dark:text-gray-600">|</span>
          <div class="flex flex-wrap gap-2">
            {% for tag in page.meta.tags %}
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ring-1 ring-gray-300 dark:ring-gray-700 text-gray-600 dark:text-gray-400">{{ tag }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% if page.meta.description %}
        <p class="mt-4 text-lg text-gray-600 dark:text-gray-400 border-l-4 border-gray-900 dark:border-gray-100 pl-4">{{ page.meta.description }}</p>
        {% endif %}
        <hr class="mt-8 border-gray-200 dark:border-gray-800">
      </div>
      {% endif %}

      <!-- Article content -->
      <article class="prose prose-lg prose-gray dark:prose-invert">
        {{ page.content }}
      </article>

      <!-- Prev/Next navigation -->
      {% if page.previous_page or page.next_page %}
      <nav class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-800 grid grid-cols-1 sm:grid-cols-2 gap-4">
        {% if page.previous_page %}
        <a href="{{ page.previous_page.url | url }}" class="group flex flex-col items-start rounded-xl border border-gray-200 dark:border-gray-800 p-4 hover:border-gray-900 dark:hover:border-gray-100 transition-all duration-200">
          <span class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">&larr; Previous</span>
          <span class="font-medium text-gray-900 dark:text-gray-100 group-hover:text-gray-600 dark:group-hover:text-gray-400 transition-colors">{{ page.previous_page.title }}</span>
        </a>
        {% else %}
        <div></div>
        {% endif %}
        {% if page.next_page %}
        <a href="{{ page.next_page.url | url }}" class="group flex flex-col items-end rounded-xl border border-gray-200 dark:border-gray-800 p-4 hover:border-gray-900 dark:hover:border-gray-100 transition-all duration-200 text-right">
          <span class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Next &rarr;</span>
          <span class="font-medium text-gray-900 dark:text-gray-100 group-hover:text-gray-600 dark:group-hover:text-gray-400 transition-colors">{{ page.next_page.title }}</span>
        </a>
        {% endif %}
      </nav>
      {% endif %}

    </div>
    {% endif %}

  </main>

  <!-- Footer -->
  <footer class="mt-auto border-t border-gray-200 dark:border-gray-800">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-6">
      <p class="text-center text-sm text-gray-500 dark:text-gray-400">
        &copy; <script>document.write(new Date().getFullYear())</script> {{ config.site_name }}. All rights reserved.
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    // Dark mode toggle
    function toggleTheme() {
      var html = document.documentElement;
      var isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('theme-toggle-mobile').addEventListener('click', toggleTheme);

    // Mobile drawer
    var drawer = document.getElementById('drawer');
    var overlay = document.getElementById('drawer-overlay');
    function openDrawer() {
      drawer.classList.remove('translate-x-full');
      overlay.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    function closeDrawer() {
      drawer.classList.add('translate-x-full');
      overlay.classList.add('hidden');
      document.body.style.overflow = '';
    }
    document.getElementById('menu-toggle').addEventListener('click', openDrawer);
    document.getElementById('drawer-close').addEventListener('click', closeDrawer);
    overlay.addEventListener('click', closeDrawer);
  </script>

</body>
</html>
